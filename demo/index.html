<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SiphonJS Demonstration - USA Temperatures</title>

  <script
       src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFZ17efCedehtFstP6dLziBgeDPnDdyMs&libraries=visualization&callback=initMap">
  </script>
   
</head>
<body>
  <h1>USA Temperatures</h1>

  <div id="map-canvas" class="heatmap" style="postion: relative; height: 500px; width: 1000px">

  </div>
  <script>
    window.onload = function() {

      // don't forget to add gmaps-heatmap.js
      var myLatlng = new google.maps.LatLng(40, -100.10);
      // map options,
      var myOptions = {
        zoom: 4,
        center: myLatlng
      };
      // standard map
      map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
      // heatmap layer
      heatmap = new HeatmapOverlay(map, 
        {
          // radius should be small ONLY if scaleRadius is true (or small radius is intended)
          "radius": 3,
          "maxOpacity": 1, 
          // scales the radius based on map zoom
          "scaleRadius": false, 
          // if set to false the heatmap uses the global maximum for colorization
          // if activated: uses the data maximum within the current map boundaries 
          //   (there will always be a red spot with useLocalExtremas true)
          "useLocalExtrema": true,
          // which field name in your data represents the latitude - default "lat"
          latField: 'lat',
          // which field name in your data represents the longitude - default "lng"
          lngField: 'lng',
          // which field name in your data represents the data value - default "value"
          valueField: 'temp'
        }
      );

      var testData = {max: 80, min: -10, data: []};

      var socket = io('http://138.68.62.90:3000');
      socket.on('connect', function(){
        console.log('connected');
      });
      socket.on('temps', function(newData){
        var allData = testData.data;
	      for(var i = 0; i < newData.length; i++) {
          if(newData[i]) allData.push(newData[i]);
        }
        
        var together = Object.assign({}, testData, { data: allData });
        console.log('new data', together.data.length);
        heatmap.setData(together);

      });
      socket.on('disconnect', function(){
        console.log('disconnected')
      });

      heatmap.setData(testData);
    }
  </script>

  <script src="/scripts/heatmap.js"></script>
  <script src="/scripts/gmaps-heatmap.js"></script>
  <script src="scripts/socket.io.min.js"></script>
  
</body>
</html>

